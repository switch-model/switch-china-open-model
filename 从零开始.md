# 从零开始设置SWITCH-China

## 阅读指南

SWITCH团队准备了非常详细的安装指南：

<https://github.com/switch-model/switch_tutorial>


## 所需软件及安装

* Python 3.7
* 求解器：gurobi, cplex, cbc, glpk, 等

软件安装与系统和个人偏好有关，请参考SWITCH GitHub[安装步骤](https://github.com/switch-model/switch/blob/master/INSTALL.md).


- 安装miniconda
- 虚拟环境 

标准安装switch-model

```
conda create -n switch python=3.7
conda activate switch
conda install -c conda-forge switch_model
```

安装包含定制模块的switch程序

```
conda create -n switch python=3.7
conda install -n switch pip
conda activate switch
cd switch/path/with-china-modules
pip install --upgrade --editable .
```




## 测试案例模型

```
cd ..switch/examples/3zone_toy
switch solve --verbose
```

如果案例模型能顺利求解，说明安装正确。

## 运行SWITCH-China基础模型

把``inputs``目录及数据拷贝到 ``/china-scenrios/china-basic`` 目录或自定义目录，然后试运行。

```
cd ..switch/china-scenrios/china-basic
switch solve --verbose
```

## 中国模块
为考虑中国中央政府和地方政府制定的各类技术目标，比方说全国煤炭封顶目标（最大装机），以及各省风电和光伏或其他技术的装机容量目标（最小装机），SWITCH-China增加了``tech_plans.py``模块。为考虑机组层面水的限制和影响，增加了``water_limits.py``模块。这两个模块置于``switch_model/china``目录之下。

如果要使用这些模块，在inputs文件夹内，``modules.tex`` 文件的模块清单增加相应模块即可，注意必须准备相应数据模块才会运行。

```
switch_model.china.tech_plans
switch_model.china.water_limits
```

``total_capacity_limits.csv``为全国安装容量限制。``capacity_plans.csv``为分省分技术安装目标。水的模块相应需要准备分流域分期水量限制数据。


## 常见报错

- SWITCH模型版本问题。该数据顺利运行版本为2.0.6，如果版本升级有修改表格、参数或其他，数据表格需要做相应修订。可以跟通过GitHub版本对照来修改。 
- 未在``modules.tex`` 文件更新需考虑的模块，或添加了模块但未添加相应数据。
- 设定最大装机和最小装机冲突导致无法求解。
- 机组名称等不能用空格。

## 升级到2.0.7

阅读升级日志：
<https://github.com/switch-model/switch/blob/35bd3596a031fac7891f762cc87af610ded13615/CHANGELOG.md>

- China modules不会自动安装，需要develop 安装；
	- 拷贝china modules到switch_module目录
	- 重新安装有新modules的switch
	- `pip install --upgrade --editable .` 
- 需要添加switch\_inputs\_version.txt文件到inputs文件夹；
- generation\_projects\_info.csv表格需命名为gen_info.csv
- quick start module可以删掉，已经整合到其他模块当中；
- gen\_build\_predetermined.csv表格列名称gen\_predetermined\_cap改成build\_gen\_predetermined；
- 输电线路可双向输电两点之间只需一条线

